<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset='utf-8'>
		<meta http-equiv='X-UA-Compatible' content='IE=edge'>
		<title>Test A</title>
		<meta name='viewport' content='width=device-width, initial-scale=1'>
		<script>
			const template = {
				"/a": `<form id="tab">
					Name:
					<p><input id="first-name" value="First name..."></p>
					<p><input id="last-name" value="Last name..."></p>
					<p><button onclick="myFlow.step(getForm())">Next</button></p>
				</form>`,
				"/b": `<form id="tab">
					Contact Info:
					<p><input id="e-mail" value="E-mail..."></p>
					<p><input id="phone" value="Phone..."></p>
					<p><button onclick="myFlow.step(getForm())">Next</button></p>
				</form>`,
				"/c": `<form id="tab">
					Birthday:
					<p><input id="birthday-dd" value="dd"></p>
					<p><input id="birthday-mm" value="mm"></p>
					<p><input id="birthday-yyyy" value="yyyy"></p>
					<p><button onclick="myFlow.step(getForm())">Next</button></p>
				</form>`,
				"/d": `<form id="tab">
					Login Info:
					<p><input id="username" value="Username..."></p>
					<p><input id="password" value="Password..."></p>
					<p><button onclick="myFlow.step(getForm())">Submit</button></p>
				</form>`
			}
		</script>
		<script type="module">
			import { flow } from "./wizard-lube.js"
			const goto = pathname => {
				history.pushState(null, "", pathname)
				document.body.innerHTML = template[location.pathname]
			}

			window.getForm = () => {
				let data = {}
				document.getElementById("tab")
					.querySelectorAll("[id]")
					.forEach(value => {
						data[value.id.replace(/-[a-z]/g, s => String.fromCharCode(s.charCodeAt(1) -32))] = value.value
					})
				return data
			}
			window.myFlow = flow()
					.add("a", data => {
						alert(JSON.stringify(data, null, 2))
						goto("/b")
					})
					.add("b", data => {
						alert(JSON.stringify(data, null, 2))
						goto("/c")
					})
					.add("c", data => {
						alert(JSON.stringify(data, null, 2))
						goto("/d")
					})
					.add("d", data => {
						alert(JSON.stringify(data, null, 2))
					})
					.begin()

			addEventListener("popstate", () => {
				if (location.pathname === "/") {
					goto("/a")
				} else {
					document.body.innerHTML = template[location.pathname]
				}
			})
			goto("/a")
		</script>
	</head>
	<body>
	</body>
</html>